const implicitMultiplication=require("./utilities/implicit-multiplication/implicit-multiplication"),removeUnnecessary=require("./utilities/remove-unnecessary/remove-unnecessary"),simplify=require("./utilities/simplify/simplify"),resolve=require("./utilities/resolve/resolve"),decimalToFrac=require("./utilities/decimal-to-frac/decimal-to-frac"),toSciNotation=require("./utilities/to-sci-notation/to-sci-notation"),smartToFixed=require("./utilities/smart-to-fixed/smart-to-fixed"),hasFunctions=require("./utilities/has-functions/has-functions"),isValidWithFunctions=require("./utilities/is-valid-with-functions/is-valid-with-functions"),resolveFunctions=require("./utilities/resolve-functions/resolve-functions"),isValidNoFunctions=require("./utilities/is-valid-no-functions/is-valid-no-functions"),hasLatex=require("./utilities/has-latex/has-latex"),latexToZadcalc=require("./utilities/latex-to-zadcalc/latex-to-zadcalc"),replaceConstants=require("./utilities/replace-constants/replace-constants");let mathResolver={settings:{to_fixed:5,smart_to_fixed:!0,frac_mode:!1,positive_sign:!1,return_as_string:!0,always_return_sci_notation:!1}};function hasConstants(t){return/E|PI|π|TAU|τ|PHI|φ|ϕ/.test(t)}function resolvePipeline(t){return/[{([]/.test(t)?(t=implicitMultiplication(t),t=removeUnnecessary(t),/[{([]/.test(t)&&(t=simplify(t)),resolve(t)):resolve(t)}mathResolver.evalExpression=t=>{if(t=t.toString(),mathResolver.settings.frac_mode&&!mathResolver.settings.return_as_string)return"Settings Error! frac mode only works when return_as_string is true";if(mathResolver.settings.frac_mode&&mathResolver.settings.smart_to_fixed)return"Settings Error!: frac mode and smart to fixed are true, but you can choose just one of them, turn off one and try again!";if(mathResolver.settings.frac_mode&&mathResolver.settings.always_return_sci_notation)return"Settings Error!: frac mode and sci notation are true, but you can choose just one of them, turn off one and try again!";if(mathResolver.settings.always_return_sci_notation&&!mathResolver.settings.return_as_string)return"Settings Error!: Always return sci notation only works when retur as string is true ";if(mathResolver.settings.positive_sign&&!mathResolver.settings.return_as_string)return"Settings Error! positve_sign just works when return as string is true";if(hasLatex(t)&&(t=latexToZadcalc(t)),hasConstants(t=t.replace(/\s/g,"")))try{t=replaceConstants(t)}catch(e){return`Error while trying to replace constants in ${t}:\n\t ${e.message}`}if(hasFunctions(t)){if(!isValidWithFunctions(t))return"Error: Invalid function";try{t=resolveFunctions(t)}catch(t){return`Error in function: ${t.message}`}if(!isValidNoFunctions(t))return"Invalid expression after resolving functions";try{t=resolvePipeline(t)}catch(e){return`Erro while trying to resolve ${t}:\n\t${e.message}`}}else{if(!isValidNoFunctions(t))return"Invalid Expression";try{t=resolvePipeline(t)}catch(e){return`Erro while trying to resolve ${t}:\n\t${e.message}`}}if(Number(t)!==Math.round(Number(t)))if(mathResolver.settings.frac_mode)t=decimalToFrac(t);else{if(/^[+-]?\d+(\.\d+)?e[+-]?\d+$/.test(t))return smartToFixed(t);if(mathResolver.settings.always_return_sci_notation)return toSciNotation(t);if(mathResolver.settings.smart_to_fixed)t=smartToFixed(t);else{t.split(".")[1].length>mathResolver.settings.to_fixed&&(t=`${Number(t).toFixed(mathResolver.settings.to_fixed)}`)}}else mathResolver.settings.always_return_sci_notation&&(t=toSciNotation(t));return Number(t)>0&&"+"!==t[0]&&mathResolver.settings.positive_sign&&(t=`+${t}`),mathResolver.settings.positive_sign||"+"!==t[0]||(t=t.slice(1)),mathResolver.settings.return_as_string?t:Number(t)},module.exports=mathResolver;